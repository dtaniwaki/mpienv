#!/bin/bash

ROOT=$(dirname $0)
ROOT=$(cd $ROOT; pwd) # Normalize the path

if [ ! -f $ROOT/shims ]; then
    G=$ROOT/version_global
    if [ -f $G ]; then
        ln -s $(cat $G) $ROOT/shims
    fi
fi

export PATH=$ROOT/shims/bin:${PATH:-}
export LD_LIBRARY_PATH=$ROOT/shims/lib:$ROOT/shims/lib64:${LD_LIBRARY_PATH:-}

echo ROOT=$ROOT

source <(cat <<EOF
function mpienv() {
    echo ROOT=$ROOT
    command="\$1"
    shift

    case "\$command" in
        "use" )
            {
                python $ROOT/mpienv_use.py \$*
            }
            ;;
        "add" )
            {
                python $ROOT/mpienv_add.py \$*
            }
            ;;
        "list" )
            {
                python $ROOT/mpienv_list.py \$*
            }
            ;;
        "info" )
            {
                python $ROOT/mpienv_info.py \$*
            }
            ;;
        "autodiscover" )
            {
                python $ROOT/mpienv_autodiscover.py \$*
            }
            ;;
        * )
            echo "mpienv [ERROR]: Unknown command '\$command'"
            ;;
    esac
}

EOF
)
